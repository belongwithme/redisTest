# 切片集群

## 能简单介绍一下Redis Cluster吗？为什么需要切片集群？
Redis Cluster是Redis官方提供的分布式解决方案，它通过数据分片技术将数据自动分散存储到多个节点上，实现了水平扩展能力.
Redis需要切片集群主要是为了解决单机Redis的几个关键限制：
首先是内存容量限制。单个Redis实例受限于服务器物理内存，通常建议不超过25-30GB。而在大型应用中，数据量轻易就能超过这个限制。通过切片集群，我们可以将数据分散到多个节点，突破单机内存限制。
其次是计算能力瓶颈。单个Redis实例使用单线程模型处理命令，虽然非常高效，但仍有性能上限,通过切片集群，请求会被分散到多个节点处理，可以显著提高了整体吞吐量.
第三是网络带宽限制。单个Redis实例的网络IO也是有上限的，特别是在高并发读写场景下。切片集群可以分散网络压力。
最后，切片集群还提供了更高的可用性。Redis Cluster内置了主从复制和故障自动转移机制，当主节点故障时，集群会自动选举对应的从节点升级为新主节点，保证服务持续可用。

## Redis Cluster的数据分片机制是怎样的？
Redis Cluster采用哈希槽(Hash Slot)的方式进行数据分片，这是一种非常精巧的设计.
整个集群固定划分为16384个槽位，每个主节点负责其中一部分槽位。数据分片的具体过程是：
首先，对每个key使用CRC16算法计算哈希值，然后对16384取模，得到0-16383之间的一个槽位号。
然后，根据这个槽位号找到负责该槽位的节点，将数据存储在该节点上。这样，数据就被均匀地分散到了集群的各个节点。

关于为什么选择16384(2^14)个槽而不是更多，这是Redis作者经过权衡后的决定：
- 16384个槽占用空间小，使用2个字节就能表示所有槽位
- 槽位太多会增加心跳包大小和内存消耗
- 槽位太少则不利于均匀分配和迁移

Redis Cluster还有一个重要特性是槽位迁移。当我们需要扩容或缩容集群时，可以在线迁移槽位及其数据，而不影响集群的正常服务。在迁移过程中，客户端请求会通过MOVED或ASK重定向到正确的节点。

## 哈希槽的算法是什么
Redis Cluster使用的hash槽算法相对简单但非常高效，它主要基于CRC16(Cyclic Redundancy Check- 循环冗余校验算法)哈希函数。
### 基本算法流程
- CRC16哈希计算：对key使用CRC16算法计算出一个16位的哈希值
- 取模运算：将得到的哈希值对16384取模，得到槽位号(0-16383)


