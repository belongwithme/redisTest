# RabbitMQ Demo 运行验证指南

## 前提条件

在开始验证之前，请确保：

1. ✅ RabbitMQ 服务已启动（Docker 或本地安装）
2. ✅ SpringBoot 应用已成功启动
3. ✅ 所有依赖已正确加载

## 一、环境验证

### 1.1 验证 RabbitMQ 服务

```bash
# 检查 Docker 容器状态
docker ps | grep rabbitmq

# 检查 RabbitMQ 管理界面
curl -u admin:admin123 http://localhost:15672/api/whoami
```

**预期结果**：
- Docker 容器正在运行
- 管理界面返回用户信息

### 1.2 验证 SpringBoot 应用

```bash
# 检查应用健康状态
curl http://localhost:8080/api/message/health

# 检查应用启动日志
# 应该看到队列和交换机创建成功的日志
```

**预期结果**：
```json
{
  "status": "UP",
  "timestamp": "2024-01-01T12:00:00",
  "service": "RabbitMQ Demo",
  "version": "1.0.0"
}
```

### 1.3 验证队列和交换机创建

访问 RabbitMQ 管理界面：http://localhost:15672

**检查队列**：
- `hello.queue` - 简单消息队列
- `user.queue` - 用户对象队列  
- `topic.queue` - Topic队列
- `fanout.queue` - Fanout队列
- `dead.letter.queue` - 死信队列

**检查交换机**：
- `hello.exchange` - 直连交换机
- `user.exchange` - 用户对象交换机
- `topic.exchange` - Topic交换机
- `fanout.exchange` - Fanout交换机
- `dead.letter.exchange` - 死信交换机

## 二、功能验证测试

### 2.1 简单消息发送测试

```bash
# 发送简单文本消息
curl -X POST "http://localhost:8080/api/message/send?message=Hello RabbitMQ"
```

**预期结果**：
- ✅ API 返回成功响应
- ✅ 控制台输出生产者发送日志
- ✅ 控制台输出消费者接收日志

**控制台输出示例**：
```
准备发送简单消息: Hello RabbitMQ
发送时间: 2024-01-01T12:00:00
消息发送完成!
========================================
【简单消息消费者】收到新消息!
接收时间: 2024-01-01T12:00:00
消息内容: Hello RabbitMQ
消息处理成功，已确认!
```

### 2.2 用户对象消息测试

```bash
# 发送用户对象消息
curl -X POST "http://localhost:8080/api/message/send-object" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "张三",
    "age": 25,
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "address": "北京市朝阳区"
  }'
```

**预期结果**：
- ✅ 用户对象成功序列化为JSON发送
- ✅ 消费者成功反序列化用户对象
- ✅ 显示用户详细信息和验证结果

### 2.3 批量消息测试

```bash
# 批量发送10条消息
curl -X POST "http://localhost:8080/api/message/send-batch" \
  -H "Content-Type: application/json" \
  -d '{
    "messagePrefix": "测试消息",
    "count": 10
  }'
```

**预期结果**：
- ✅ 生产者发送10条消息
- ✅ 消费者依次接收并处理所有消息
- ✅ 消息顺序处理，无丢失

### 2.4 带属性消息测试

```bash
# 发送带优先级和过期时间的消息
curl -X POST "http://localhost:8080/api/message/send-with-properties" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "高优先级消息",
    "priority": 8,
    "expiration": 30000
  }'
```

**预期结果**：
- ✅ 消息包含正确的优先级和过期时间
- ✅ 消费者能读取到消息属性
- ✅ 显示自定义头部信息

### 2.5 Topic 交换机测试

```bash
# 发送 Topic 消息
curl -X POST "http://localhost:8080/api/message/send-topic" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "用户信息更新",
    "routingKey": "user.update"
  }'
```

**预期结果**：
- ✅ 消息根据路由键正确路由
- ✅ Topic消费者接收到消息
- ✅ 显示路由键信息

### 2.6 Fanout 广播测试

```bash
# 发送广播消息
curl -X POST "http://localhost:8080/api/message/send-fanout" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "系统广播通知"
  }'
```

**预期结果**：
- ✅ 消息发送到所有绑定的队列
- ✅ Fanout消费者接收到广播消息

### 2.7 延迟消息测试

```bash
# 发送10秒延迟消息
curl -X POST "http://localhost:8080/api/message/send-delay" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "延迟消息测试",
    "delaySeconds": 10
  }'
```

**预期结果**：
- ✅ 消息在指定时间后才被消费
- ✅ 延迟时间准确

### 2.8 示例用户创建测试

```bash
# 创建并发送示例用户
curl -X POST "http://localhost:8080/api/message/create-sample-user"
```

**预期结果**：
- ✅ 创建包含完整信息的示例用户
- ✅ 用户对象正确序列化和反序列化

## 三、管理界面验证

### 3.1 访问 RabbitMQ 管理界面

1. 打开浏览器访问：http://localhost:15672
2. 使用账户登录：用户名 `admin`，密码 `admin123`

### 3.2 查看队列状态

在 **Queues** 页面查看：
- 队列消息数量统计
- 消息发送和接收速率
- 消费者连接状态

### 3.3 查看交换机状态

在 **Exchanges** 页面查看：
- 交换机类型和绑定关系
- 消息路由统计

### 3.4 查看连接状态

在 **Connections** 页面查看：
- SpringBoot 应用的连接状态
- 通道（Channel）使用情况

## 四、性能和压力测试

### 4.1 高并发消息测试

```bash
# 并发发送大量消息（谨慎使用）
for i in {1..100}; do
  curl -X POST "http://localhost:8080/api/message/send?message=并发消息$i" &
done
wait
```

### 4.2 大批量消息测试

```bash
# 发送大批量消息
curl -X POST "http://localhost:8080/api/message/send-batch" \
  -H "Content-Type: application/json" \
  -d '{
    "messagePrefix": "压力测试",
    "count": 1000
  }'
```

**监控指标**：
- CPU 使用率
- 内存使用率
- 队列消息堆积情况
- 消息处理延迟

## 五、异常情况测试

### 5.1 消息发送失败测试

```bash
# 发送空消息（应该失败）
curl -X POST "http://localhost:8080/api/message/send?message="
```

**预期结果**：返回错误响应，包含错误信息

### 5.2 无效用户对象测试

```bash
# 发送无效用户对象
curl -X POST "http://localhost:8080/api/message/send-object" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "",
    "age": -1
  }'
```

### 5.3 服务停止测试

1. 停止 RabbitMQ 服务
2. 尝试发送消息
3. 重启 RabbitMQ 服务
4. 验证连接自动恢复

## 六、日志监控验证

### 6.1 应用日志查看

查看 SpringBoot 应用控制台输出，应包含：
- 连接建立日志
- 队列和交换机创建日志
- 消息发送和接收日志
- 错误和异常日志

### 6.2 RabbitMQ 日志查看

```bash
# 查看 RabbitMQ 容器日志
docker logs rabbitmq

# 实时跟踪日志
docker logs -f rabbitmq
```

## 七、API 接口测试汇总

### 可用的测试接口：

| 方法 | 路径 | 描述 | 示例 |
|------|------|------|------|
| GET | `/api/message/` | 欢迎页面和接口列表 | - |
| POST | `/api/message/send` | 发送简单消息 | `?message=Hello` |
| POST | `/api/message/send-object` | 发送用户对象 | JSON Body |
| POST | `/api/message/send-batch` | 批量发送消息 | JSON Body |
| POST | `/api/message/send-with-properties` | 发送带属性消息 | JSON Body |
| POST | `/api/message/send-topic` | 发送Topic消息 | JSON Body |
| POST | `/api/message/send-fanout` | 发送Fanout消息 | JSON Body |
| POST | `/api/message/send-delay` | 发送延迟消息 | JSON Body |
| POST | `/api/message/create-sample-user` | 创建示例用户 | - |
| GET | `/api/message/statistics` | 获取统计信息 | - |
| GET | `/api/message/health` | 健康检查 | - |

## 八、常见问题排查

### 8.1 连接失败
```bash
# 检查网络连接
telnet localhost 5672

# 检查认证信息
curl -u admin:admin123 http://localhost:15672/api/overview
```

### 8.2 消息不被消费
- 检查消费者是否正常启动
- 查看队列是否有消息堆积
- 检查消费者异常日志

### 8.3 性能问题
- 监控内存使用情况
- 检查消息确认机制
- 调整预取数量配置

---

**验证完成标准**：
- ✅ 所有API接口正常响应
- ✅ 消息正确发送和接收
- ✅ 对象序列化/反序列化正常
- ✅ 不同类型交换机工作正常
- ✅ 异常情况正确处理
- ✅ RabbitMQ 管理界面显示正常

完成以上验证后，您的 RabbitMQ Demo 项目就可以正常使用了！